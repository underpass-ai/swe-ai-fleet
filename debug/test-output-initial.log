üîß Preparing test environment...

‚úÖ Virtual environment activated

üì¶ Generating gRPC stubs for tests...
üì¶ Generating orchestrator stubs...
üì¶ Generating context stubs...
üìù Creating __init__.py files...
‚úÖ gRPC stubs generated successfully

üß™ Running unit tests...

============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/tirso/ai/developents/swe-ai-fleet
configfile: pytest.ini
plugins: anyio-4.11.0, cov-7.0.0, asyncio-1.2.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 865 items / 29 deselected / 836 selected

tests/unit/agents/test_vllm_agent_unit.py ..........                     [  1%]
tests/unit/context/consumers/test_orchestration_consumer.py ...........  [  2%]
tests/unit/context/consumers/test_planning_consumer.py ..........        [  3%]
tests/unit/context/usecases/test_project_decision.py ........            [  4%]
tests/unit/context/usecases/test_update_subtask_status.py .........      [  5%]
tests/unit/evaluators/test_judge.py .......                              [  6%]
tests/unit/evaluators/test_lint_checks.py ......                         [  7%]
tests/unit/evaluators/test_policy_checks.py .......                      [  8%]
tests/unit/orchestrator/config_module/test_agent_configuration.py .....  [  8%]
tests/unit/orchestrator/domain/agents/test_mock_agent.py ............... [ 10%]
........                                                                 [ 11%]
tests/unit/orchestrator/domain/check_results/test_check_result.py ...... [ 12%]
                                                                         [ 12%]
tests/unit/orchestrator/test_deliberate_integration.py ........          [ 13%]
tests/unit/orchestrator/test_model_adapter_integration.py .........      [ 14%]
tests/unit/orchestrator/test_orchestrate_integration.py ........         [ 15%]
tests/unit/orchestrator/usecases/test_deliberate.py ..........           [ 16%]
tests/unit/orchestrator/usecases/test_orchestrate.py ........            [ 17%]
tests/unit/ray_jobs/application/test_execute_agent_task.py .ss..         [ 17%]
tests/unit/ray_jobs/application/test_generate_proposal.py ....           [ 18%]
tests/unit/ray_jobs/domain/test_agent_config.py ...s.sss.                [ 19%]
tests/unit/ray_jobs/infrastructure/adapters/test_asyncio_executor.py ... [ 19%]
...                                                                      [ 20%]
tests/unit/ray_jobs/infrastructure/adapters/test_vllm_http_client.py sss [ 20%]
sss                                                                      [ 20%]
tests/unit/ray_jobs/infrastructure/test_ray_agent_factory.py ..s..s.     [ 21%]
tests/unit/ray_jobs/test_vllm_agent_job_unit.py ..sssssssssss            [ 23%]
tests/unit/services/context/test_persistence_unit.py ...............     [ 25%]
tests/unit/services/context/test_server.py ...................           [ 27%]
tests/unit/services/orchestrator/application/usecases/test_list_councils_usecase.py . [ 27%]
.....                                                                    [ 28%]
tests/unit/services/orchestrator/domain/entities/test_service_configuration.py . [ 28%]
.........                                                                [ 29%]
tests/unit/services/orchestrator/domain/ports/test_scoring_port.py ..... [ 29%]
...                                                                      [ 30%]
tests/unit/services/orchestrator/test_server.py ................         [ 32%]
tests/unit/test_architect_unit.py ..                                     [ 32%]
tests/unit/test_context_assembler_unit.py .....................          [ 34%]
tests/unit/test_context_domain_models_unit.py .......................... [ 38%]
.....................                                                    [ 40%]
tests/unit/test_context_usecases_unit.py ....................            [ 42%]
tests/unit/test_council_unit.py .                                        [ 43%]
tests/unit/test_decision_enriched_report_llm_unit.py .                   [ 43%]
tests/unit/test_decision_enriched_report_unit.py ....                    [ 43%]
tests/unit/test_deliberate_async_usecase.py .......                      [ 44%]
tests/unit/test_models_loaders_unit.py ......                            [ 45%]
tests/unit/test_neo4j_command_store_unit.py ......................       [ 47%]
tests/unit/test_neo4j_decision_graph_read_adapter_unit.py ......         [ 48%]
tests/unit/test_neo4j_graph_analytics_read_adapter_unit.py ............. [ 50%]
.                                                                        [ 50%]
tests/unit/test_orchestrator_domain_unit.py ............................ [ 53%]
.............                                                            [ 55%]
tests/unit/test_projector_coordinator_unit.py .............              [ 56%]
tests/unit/test_projector_usecases.py ........                           [ 57%]
tests/unit/test_prompt_scope_policy_unit.py ........................     [ 60%]
tests/unit/test_redis_planning_read_adapter_unit.py ..                   [ 60%]
tests/unit/test_redis_store_unit.py .....                                [ 61%]
tests/unit/test_rehydration_bundle_unit.py .                             [ 61%]
tests/unit/test_rehydration_request_unit.py ..                           [ 61%]
tests/unit/test_reports_decision_domain_unit.py .....                    [ 62%]
tests/unit/test_reports_domain_unit.py .....                             [ 62%]
tests/unit/test_reports_dtos_unit.py ........                            [ 63%]
tests/unit/test_reports_neo4j_query_store_unit.py ..                     [ 64%]
tests/unit/test_reports_redis_adapter_unit.py .......                    [ 64%]
tests/unit/test_reports_usecase_unit.py ..........                       [ 66%]
tests/unit/test_role_context_fields_unit.py ......                       [ 66%]
tests/unit/test_role_context_pack_unit.py ..                             [ 67%]
tests/unit/test_router_integration.py s                                  [ 67%]
tests/unit/test_runner_tool_implementation.py .....................      [ 69%]
tests/unit/test_runner_tool_unit.py ....................                 [ 72%]
tests/unit/test_session_rehydration_unit.py ..                           [ 72%]
tests/unit/test_test_runner_unit.py ............                         [ 73%]
tests/unit/test_tools_redis_event_bus_unit.py .                          [ 73%]
tests/unit/test_web_server_unit.py ....                                  [ 74%]
tests/unit/tools/test_file_tool_unit.py .............                    [ 75%]
tests/unit/tools/test_git_tool_unit.py .......                           [ 76%]
tests/unit/tools/test_helm_tool.py .......                               [ 77%]
tests/unit/tools/test_kubectl_tool.py .........                          [ 78%]
tests/unit/tools/test_psql_tool.py ..........                            [ 79%]
tests/unit/tools/test_validators_unit.py ............................... [ 83%]
....                                                                     [ 84%]
services/orchestrator/tests/application/test_delete_council_usecase.py . [ 84%]
...                                                                      [ 84%]
services/orchestrator/tests/application/test_deliberate_async_fix.py ... [ 84%]
.                                                                        [ 85%]
services/orchestrator/tests/application/test_deliberate_usecase.py ..... [ 85%]
.                                                                        [ 85%]
services/orchestrator/tests/application/test_list_councils_usecase.py .. [ 86%]
.                                                                        [ 86%]
services/orchestrator/tests/domain/test_agent_collection.py ............ [ 87%]
                                                                         [ 87%]
services/orchestrator/tests/domain/test_agent_config.py .....            [ 88%]
services/orchestrator/tests/domain/test_agent_type.py ....               [ 88%]
services/orchestrator/tests/domain/test_check_suite.py ........          [ 89%]
services/orchestrator/tests/domain/test_council_registry.py ............ [ 91%]
.                                                                        [ 91%]
services/orchestrator/tests/domain/test_deliberation_result_data.py .... [ 91%]
.......                                                                  [ 92%]
services/orchestrator/tests/domain/test_deliberation_tracker_port.py ... [ 92%]
.                                                                        [ 92%]
services/orchestrator/tests/domain/test_messaging_port.py .......        [ 93%]
services/orchestrator/tests/domain/test_role_collection.py .....         [ 94%]
services/orchestrator/tests/domain/test_service_configuration.py .....   [ 94%]
services/orchestrator/tests/domain/test_statistics.py ......             [ 95%]
services/orchestrator/tests/infrastructure/handlers/test_planning_consumer.py . [ 95%]
.....                                                                    [ 96%]
services/orchestrator/tests/infrastructure/test_council_info_mapper.py . [ 96%]
....                                                                     [ 97%]
services/orchestrator/tests/infrastructure/test_council_query_adapter.py . [ 97%]
.......                                                                  [ 97%]
services/orchestrator/tests/infrastructure/test_deliberate_council_factory_adapter.py . [ 98%]
..                                                                       [ 98%]
services/orchestrator/tests/infrastructure/test_deliberation_status_mapper.py . [ 98%]
.......                                                                  [ 99%]
services/orchestrator/tests/infrastructure/test_environment_configuration_adapter.py . [ 99%]
...                                                                      [ 99%]
services/orchestrator/tests/infrastructure/test_vllm_agent_factory_adapter.py . [ 99%]
.                                                                        [100%]

=============================== warnings summary ===============================
tests/unit/test_runner_tool_implementation.py::TestRunnerToolImplementation::test_await_result_success
  /home/tirso/ai/developents/swe-ai-fleet/tests/unit/test_runner_tool_implementation.py:209: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    started_at = datetime.utcnow()

tests/unit/test_runner_tool_implementation.py::TestRunnerToolImplementation::test_await_result_success
  /home/tirso/ai/developents/swe-ai-fleet/tests/unit/test_runner_tool_implementation.py:210: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    finished_at = datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.7-final-0 ________________

Name                                                                                    Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------------------------------------------------
core/__init__.py                                                                            2      0   100%
core/agents/__init__.py                                                                     7      2    71%   24-26
core/agents/profile_loader.py                                                              49     30    39%   11-13, 31-41, 99-140
core/agents/vllm_agent.py                                                                 301    127    58%   119-121, 256-273, 288-289, 490, 589, 628-637, 688-797, 836-879, 910-926, 1040, 1045-1049, 1058, 1081-1085, 1107-1144, 1214-1216, 1226-1254, 1276-1277, 1290-1298, 1305
core/agents/vllm_client.py                                                                 88     76    14%   10-12, 45-54, 78-113, 138-201, 231-283
core/cli/__init__.py                                                                        0      0   100%
core/cli/e2e_cluster_from_yaml.py                                                          92     92     0%   1-205
core/context/__init__.py                                                                    0      0   100%
core/context/adapters/__init__.py                                                           0      0   100%
core/context/adapters/neo4j_command_store.py                                               66      0   100%
core/context/adapters/neo4j_query_store.py                                                 49     26    47%   11-15, 36-39, 43, 47, 51-66, 70-75, 79-83
core/context/adapters/redis_planning_read_adapter.py                                       62     39    37%   18, 22, 26, 30, 34, 38, 41-46, 58-79, 93-112, 115-116, 119-122
core/context/context_assembler.py                                                          46      1    98%   138
core/context/domain/__init__.py                                                             7      0   100%
core/context/domain/case.py                                                                14      0   100%
core/context/domain/case_header.py                                                         15      0   100%
core/context/domain/context_sections.py                                                    80      6    92%   60, 71-72, 153, 157, 161
core/context/domain/decision.py                                                            18      0   100%
core/context/domain/decision_relation.py                                                   10      0   100%
core/context/domain/decision_relation_list.py                                              18      0   100%
core/context/domain/domain_event.py                                                        43      2    95%   71, 79
core/context/domain/graph_relationship.py                                                  26      0   100%
core/context/domain/milestone.py                                                           10      0   100%
core/context/domain/milestone_list.py                                                      18      0   100%
core/context/domain/plan_header.py                                                         15      0   100%
core/context/domain/plan_version.py                                                        18      0   100%
core/context/domain/rehydration_bundle.py                                                  11      0   100%
core/context/domain/rehydration_request.py                                                 10      0   100%
core/context/domain/role_context_fields.py                                                 60      0   100%
core/context/domain/scopes/__init__.py                                                      0      0   100%
core/context/domain/scopes/prompt_blocks.py                                                 7      0   100%
core/context/domain/scopes/prompt_scope_policy.py                                          19      0   100%
core/context/domain/scopes/scope_check_result.py                                            6      0   100%
core/context/domain/subtask.py                                                             38      0   100%
core/context/ports/__init__.py                                                              0      0   100%
core/context/ports/decisiongraph_read_port.py                                               6      0   100%
core/context/ports/graph_command_port.py                                                    4      0   100%
core/context/ports/graph_query_port.py                                                      4      0   100%
core/context/ports/planning_read_port.py                                                    3      0   100%
core/context/session_rehydration.py                                                        97      1    99%   71
core/context/usecases/__init__.py                                                           0      0   100%
core/context/usecases/project_case.py                                                      10      0   100%
core/context/usecases/project_decision.py                                                  12      0   100%
core/context/usecases/project_plan_version.py                                              12      0   100%
core/context/usecases/project_subtask.py                                                   12      0   100%
core/context/usecases/projector_coordinator.py                                             20      0   100%
