{
  "test_id": "23-workspace-db-governed",
  "run_id": "e2e-ws-db-1771109835",
  "status": "passed",
  "started_at": "2026-02-14T22:57:15.075709+00:00",
  "workspace_url": "http://workspace.swe-ai-fleet.svc.cluster.local:50053",
  "steps": [
    {
      "at": "2026-02-14T22:57:15.087607+00:00",
      "step": "health",
      "status": "passed"
    },
    {
      "at": "2026-02-14T22:57:18.112306+00:00",
      "step": "catalog",
      "status": "passed",
      "data": {
        "tool_count": 54,
        "required_tools": [
          "mongo.aggregate",
          "mongo.find",
          "redis.del",
          "redis.exists",
          "redis.get",
          "redis.mget",
          "redis.scan",
          "redis.set",
          "redis.ttl"
        ],
        "forbidden_tools": [
          "mongo.delete",
          "mongo.insert",
          "mongo.update"
        ]
      }
    },
    {
      "at": "2026-02-14T22:57:18.122057+00:00",
      "step": "policy_deny_scopes",
      "status": "passed"
    },
    {
      "at": "2026-02-14T22:57:18.124948+00:00",
      "step": "approval_gates",
      "status": "passed"
    },
    {
      "at": "2026-02-14T22:57:24.169390+00:00",
      "step": "allowlisted_ops",
      "status": "passed"
    },
    {
      "at": "2026-02-14T22:57:24.169403+00:00",
      "step": "final",
      "status": "passed"
    }
  ],
  "sessions": [
    {
      "at": "2026-02-14T22:57:18.109014+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "payload": {
        "principal": {
          "tenant_id": "e2e-tenant",
          "actor_id": "e2e-db-governed",
          "roles": [
            "devops"
          ]
        },
        "metadata": {
          "allowed_profiles": "dev.redis,dev.mongo",
          "allowed_redis_key_prefixes": "sandbox:,dev:",
          "connection_profile_endpoints_json": "{\"dev.redis\":\"valkey.swe-ai-fleet.svc.cluster.local:6379\",\"dev.mongo\":\"mongodb://mongodb.swe-ai-fleet.svc.cluster.local:27017\"}"
        },
        "expires_in_seconds": 3600
      }
    }
  ],
  "invocations": [
    {
      "at": "2026-02-14T22:57:18.114475+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.get",
      "http_status": 403,
      "invocation_id": "inv-4fec7190b9997f1c",
      "invocation_status": "denied",
      "error_code": "policy_denied",
      "error_message": "key prefix not allowed"
    },
    {
      "at": "2026-02-14T22:57:18.116225+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.scan",
      "http_status": 403,
      "invocation_id": "inv-e6dce5a36b381158",
      "invocation_status": "denied",
      "error_code": "policy_denied",
      "error_message": "key prefix not allowed"
    },
    {
      "at": "2026-02-14T22:57:18.117779+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.set",
      "http_status": 403,
      "invocation_id": "inv-38990cfd9d0f0b5b",
      "invocation_status": "denied",
      "error_code": "policy_denied",
      "error_message": "key prefix not allowed"
    },
    {
      "at": "2026-02-14T22:57:18.119254+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.del",
      "http_status": 403,
      "invocation_id": "inv-fb87a1b83a2406eb",
      "invocation_status": "denied",
      "error_code": "policy_denied",
      "error_message": "key prefix not allowed"
    },
    {
      "at": "2026-02-14T22:57:18.120639+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "mongo.find",
      "http_status": 500,
      "invocation_id": "inv-23a3f6753de5bfd4",
      "invocation_status": "failed",
      "error_code": "policy_denied",
      "error_message": "database outside profile allowlist"
    },
    {
      "at": "2026-02-14T22:57:18.122048+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "mongo.aggregate",
      "http_status": 500,
      "invocation_id": "inv-ec2f3a99b5cb8671",
      "invocation_status": "failed",
      "error_code": "policy_denied",
      "error_message": "database outside profile allowlist"
    },
    {
      "at": "2026-02-14T22:57:18.123515+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.set",
      "http_status": 428,
      "invocation_id": "inv-8aca35bd24af75cf",
      "invocation_status": "denied",
      "error_code": "approval_required",
      "error_message": "tool requires explicit approval"
    },
    {
      "at": "2026-02-14T22:57:18.124937+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.del",
      "http_status": 428,
      "invocation_id": "inv-3e67d5ffcbe8882e",
      "invocation_status": "denied",
      "error_code": "approval_required",
      "error_message": "tool requires explicit approval"
    },
    {
      "at": "2026-02-14T22:57:18.128761+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.get",
      "http_status": 200,
      "invocation_id": "inv-0728cb6df8d5f482",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.131782+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.mget",
      "http_status": 200,
      "invocation_id": "inv-38a15d818724519a",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.142751+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.scan",
      "http_status": 200,
      "invocation_id": "inv-64bbcb7b31065cec",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.145709+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.ttl",
      "http_status": 200,
      "invocation_id": "inv-db2f4b268aa95d5d",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.148522+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.exists",
      "http_status": 200,
      "invocation_id": "inv-ae0ff1af85833574",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.151414+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.set",
      "http_status": 200,
      "invocation_id": "inv-f165010c91353a4e",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:18.155236+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "redis.del",
      "http_status": 200,
      "invocation_id": "inv-f8c4a0f4ead82cc0",
      "invocation_status": "succeeded",
      "error_code": null,
      "error_message": null
    },
    {
      "at": "2026-02-14T22:57:21.159908+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "mongo.find",
      "http_status": 500,
      "invocation_id": "inv-3c930d2b96a5ddf8",
      "invocation_status": "failed",
      "error_code": "execution_failed",
      "error_message": "mongo find failed: server selection error: context deadline exceeded, current topology: { Type: Unknown, Servers: [{ Addr: mongodb.swe-ai-fleet.svc.cluster.local:27017, Type: Unknown, Last error: dial tcp: lookup mongodb.swe-ai-fleet.svc.cluster.local on 10.96.0.10:53: no such host }, ] }"
    },
    {
      "at": "2026-02-14T22:57:24.169371+00:00",
      "session_id": "session-a6027e775e3bd16d",
      "tool": "mongo.aggregate",
      "http_status": 500,
      "invocation_id": "inv-40ce177b3d3e42c0",
      "invocation_status": "failed",
      "error_code": "execution_failed",
      "error_message": "mongo aggregate failed: server selection error: context deadline exceeded, current topology: { Type: Unknown, Servers: [{ Addr: mongodb.swe-ai-fleet.svc.cluster.local:27017, Type: Unknown, Last error: dial tcp: lookup mongodb.swe-ai-fleet.svc.cluster.local on 10.96.0.10:53: no such host }, ] }"
    }
  ],
  "ended_at": "2026-02-14T22:57:24.176823+00:00"
}
