version: '3.8'

services:
  orchestrator:
    image: localhost:5000/swe-ai-fleet/orchestrator:latest
    container_name: orchestrator-integration-test
    environment:
      - GRPC_PORT=50055
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["CMD", "python", "-c", "import grpc; channel = grpc.insecure_channel('localhost:50055'); channel.close()"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s

  test-runner:
    build:
      context: ../../../..
      dockerfile: tests/integration/services/orchestrator/Dockerfile.test
    container_name: orchestrator-test-runner
    depends_on:
      orchestrator:
        condition: service_healthy
    environment:
      - ORCHESTRATOR_HOST=orchestrator
      - ORCHESTRATOR_PORT=50055

