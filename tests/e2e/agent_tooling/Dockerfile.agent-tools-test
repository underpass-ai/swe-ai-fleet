# Lightweight agent workspace for tools E2E testing
# Only includes essentials: Python 3.13, git, pytest

FROM docker.io/library/python:3.13-slim

# Install git and ripgrep (for file search)
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    ripgrep \
    && rm -rf /var/lib/apt/lists/*

# Create workspace directory
RUN mkdir -p /workspace && chmod 777 /workspace

WORKDIR /workspace

# Create non-root user
RUN useradd -m -u 1000 agent && \
    chown -R agent:agent /workspace

USER agent

# Pre-install common test dependencies
RUN pip install --user --no-cache-dir \
    pytest>=8.0 \
    pytest-asyncio>=1.0

ENV PATH="/home/agent/.local/bin:$PATH"
ENV PYTHONUNBUFFERED=1

CMD ["/bin/bash"]

