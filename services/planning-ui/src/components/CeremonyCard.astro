---
interface Props {
  ceremony: {
    ceremony_id: string;
    status: string;
    story_ids?: string[];
    review_results?: any[];
    created_by: string;
    created_at: string;
  };
}

const { ceremony } = Astro.props;

const getStatusColor = (status: string) => {
  switch (status) {
    case 'DRAFT': return 'bg-gray-100 text-gray-800';
    case 'IN_PROGRESS': return 'bg-blue-100 text-blue-800';
    case 'REVIEWING': return 'bg-yellow-100 text-yellow-800';
    case 'COMPLETED': return 'bg-green-100 text-green-800';
    case 'CANCELLED': return 'bg-red-100 text-red-800';
    default: return 'bg-gray-100 text-gray-800';
  }
};

const totalStories = ceremony.story_ids?.length || 0;
const reviewedStories = ceremony.review_results?.length || 0;
const progress = totalStories > 0 ? Math.round((reviewedStories / totalStories) * 100) : 0;
---

<a
  href={`/ceremonies/${ceremony.ceremony_id}`}
  class="block bg-white rounded-lg border border-gray-200 hover:border-indigo-300 hover:shadow-md transition-all"
>
  <div class="p-4 space-y-3">
    <div class="flex items-center justify-between">
      <h3 class="text-sm font-medium text-indigo-600 truncate">
        {ceremony.ceremony_id}
      </h3>
      <span class={`px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(ceremony.status)}`}>
        {ceremony.status}
      </span>
    </div>

    <div class="flex items-center justify-between text-sm">
      <div class="flex items-center text-gray-500">
        <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
        </svg>
        {ceremony.created_by}
      </div>
      <div class="flex items-center text-gray-500">
        <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
        </svg>
        {new Date(ceremony.created_at).toLocaleDateString()}
      </div>
    </div>

    <div class="space-y-2">
      <div class="flex justify-between text-xs text-gray-600">
        <span>{totalStories} stories</span>
        <span>{reviewedStories} reviewed ({progress}%)</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          class="bg-indigo-600 h-2 rounded-full transition-all"
          style={`width: ${progress}%`}
        ></div>
      </div>
    </div>

    {ceremony.status === 'IN_PROGRESS' && (
      <div class="flex items-center text-xs text-blue-600">
        <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Reviews in progress...
      </div>
    )}

    {ceremony.status === 'REVIEWING' && (
      <div class="flex items-center text-xs text-yellow-600">
        <svg class="h-4 w-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        Awaiting PO approval
      </div>
    )}
  </div>
</a>

