---
import type { Story } from '../lib/types';

interface Props {
  story: Story;
}

const { story } = Astro.props;

const stateColors: Record<string, string> = {
  BACKLOG: 'bg-gray-100 text-gray-800',
  DRAFT: 'bg-blue-100 text-blue-800',
  DESIGN: 'bg-purple-100 text-purple-800',
  BUILD: 'bg-yellow-100 text-yellow-800',
  TEST: 'bg-orange-100 text-orange-800',
  DOCS: 'bg-indigo-100 text-indigo-800',
  DONE: 'bg-green-100 text-green-800',
};

const dorColor = story.dor_score >= 80 ? 'text-green-600' : story.dor_score >= 60 ? 'text-yellow-600' : 'text-red-600';
---

<div class="bg-white shadow rounded-lg p-6 hover:shadow-md transition-shadow">
  <div class="flex items-start justify-between">
    <div class="flex-1">
      <h3 class="text-lg font-semibold text-gray-900">{story.title}</h3>
      <p class="mt-1 text-sm text-gray-500 line-clamp-2">{story.brief || 'No description'}</p>
    </div>
    <span class={`ml-4 px-2 py-1 text-xs font-medium rounded-full ${stateColors[story.state] || 'bg-gray-100 text-gray-800'}`}>
      {story.state}
    </span>
  </div>
  <div class="mt-4 flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <div>
        <span class="text-xs text-gray-500">DoR Score</span>
        <div class={`text-sm font-semibold ${dorColor}`}>
          {story.dor_score}/100
        </div>
      </div>
      <div>
        <span class="text-xs text-gray-500">Created by</span>
        <div class="text-sm font-medium text-gray-900">{story.created_by}</div>
      </div>
    </div>
    <div class="text-xs text-gray-500">
      {new Date(story.created_at).toLocaleDateString()}
    </div>
  </div>
  <div class="mt-4">
    <a href={`/stories/${story.story_id}`} class="text-sm font-medium text-blue-600 hover:text-blue-800">
      View details â†’
    </a>
  </div>
</div>

